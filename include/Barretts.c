#include <stdio.h>
#include "multiplier.h"
#include "findK.h"
#include "shifting.h"
#include "subtraction.h"

#define SIZE 64

int main(int argc, char *argv[])
{
    unsigned char a[] = {
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F,
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F,
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F,
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F,
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F,
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F,
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F,
        0x83, 0x23, 0x2C, 0x6F, 0x83, 0x23, 0x2C, 0x6F};

    unsigned char b[] = {
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08,
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08,
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08,
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08,
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08,
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08,
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08,
        0x83, 0x23, 0x2C, 0x6F, 0xFB, 0x08, 0xFB, 0x08};

    unsigned char temp_c[SIZE * 2];

    unsigned char n[] = {
        0x83,
        0x23,
        0x2C,
        0x6F,
        0xFB};

    unsigned char *c = hex_multiplier(a, b, SIZE, SIZE);

    for (int i = 0; i < (SIZE * 2); i++)
    {
        temp_c[i] = c[i];
    }

    int k;
    k = FindHexK(n);
    
    while (k >= 8)
    {
        hexBitShift(temp_c, 4, SIZE * 2);
        hexBitShift(temp_c, 4, SIZE * 2);
        k -= 8;
    }
    if (k != 0)
    {
        hexBitShift(temp_c, k, SIZE * 2);
    }

    unsigned char *q = hex_multiplier(temp_c, n, SIZE * 2, (sizeof(n) / sizeof(n[0])));

    for (int i = 0; i < (SIZE * 2); i++)
    {
        printf("%02X ", q[i]);
    }

    subtractBigHexNum(temp_c, q, c, 128);
    printf("\n\n");
    // TODO : Last Needed portion is repetitive minus by n [0 -- 3n)

    for (int i = 0; i < (SIZE * 2); i++)
    {
        printf("%02X ", c[i]);
    }
}
